<div id="razorPane" class="inlinebox">
    @Html.Partial("_RazorPane")
</div>
<div id="modelPane" class="inlinebox">
    @Html.Partial("_ModelPane")
</div>
<div id="resultsPane" class="">
    @Html.Partial("_ResultsPane")
</div>
<div id="loading"></div>
<script type="text/javascript" charset="utf-8">
    var razorEditor;
    $(function () {

        function resizeRazorEditor() {
            //$("#razorEditor").height($("#razorPane").height() - $("#viewHeader").height());
            //            razorEditor.renderer.onResize();
            $(razorEditor.getScrollerElement()).css({
                height: $("#razorPane").height() - $("#viewHeader").height(),
                width: $("#razorPane").width()
            });
            razorEditor.refresh();
            resizeModelProps();
        }

        function resizeModelProps() {
            var $modelPane = $('#modelPane');
            $modelPane.find('.modelProps')
                         .height(
                            $modelPane.height()
                            - $modelPane.find('.paneheader').outerHeight(true)
                            - $modelPane.find('.propinput').outerHeight(true)
                            - 10//modelProps top and bottom padding
                            );
        }

        var outerLayout = $('body').layout({

            north__paneSelector: "#toolbar",
            north__resizable: false,
            north__spacing_open: 0,
            center__paneSelector: "#panes",
            resizeWhileDragging: true,
            closable: false
        });

        var innerLayout = $('#panes').layout({
            closable: false,
            center__paneSelector: "#modelPane",
            west__paneSelector: "#razorPane",
            west__size: Math.floor((screen.width / 1.67) - 10),
            west__maxSize: "70%",
            west__minSize: 400,
            south__paneSelector: "#resultsPane",
            south__maxSize: "70%",
            south__size: Math.floor((screen.height / 2) - 100),
            south__minSize: 200,
            resizeWhileDragging: true,
            onresize: resizeRazorEditor
        });



        //        var HtmlMode = require("ace/mode/html").Mode;
        //        razorEditor = ace.edit("razorEditor");
        //        razorEditor.getSession().setMode(new HtmlMode());
        //        razorEditor.renderer.setShowPrintMargin(false)

        razorEditor = CodeMirror.fromTextArea(document.getElementById("razorEditor"), {
            mode: "text/html",
            lineNumbers: true,
            tabMode: "indent",
            matchBrackets: true,
            tabIndex: -1,
            lineWrapping: true
        });

        $("#panes").css('visibility', 'visible');

        $(window).resize(resizeRazorEditor).resize();
    });

//    function resizeEditor(editor) {
//        //var parent = editor.closest('#razorPane');
//        //editor.height(parent.height() - editor.siblings().height());
//        
//    }
//    $(function () {
//        //        $('#razorEditor').val('<h1>Hello @@Model.Name</h1>');
//        // ace editor needs explicityly sized div
//        //resizeEditor($('#razorEditor').watermark('razor here'));
//        
//    });
</script>
